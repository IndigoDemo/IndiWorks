!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("jsRocket",[],t):"object"==typeof exports?exports.jsRocket=t():e.jsRocket=t()}(window,function(){return function(e){var t={};function n(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:s})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var s=class{constructor(){this.tracks=[]}getTrack(e){return this.tracks[e]}getIndexForName(e){for(let t=0;t<this.tracks.length;t++)if(this.tracks[t].name===e)return t;return-1}getTrackLength(){return this.tracks.length}createIndex(e){const t=new class{constructor(){this.data=[]}findKeyIndex(e,t){let n=0,s=e.length;for(;n<s;){let r=(s+n)/2|0;if(e[r]<t)n=r+1;else{if(!(e[r]>t))return r;s=r}}return n-1}getValue(e){const t=Object.keys(this.data);if(!t.length)return 0;const n=this.findKeyIndex(t,Math.floor(e));if(n<0)return this.data[t[0]].value;if(n>t.length-2)return this.data[t[t.length-1]].value;const s=t[n],r=t[n+1],a=this.data[s].value,i=this.data[r].value,o=(e-s)/(r-s);switch(this.data[s].interpolation){case 0:return a;case 1:return a+(i-a)*o;case 2:return a+(i-a)*o*o*(3-2*o);case 3:return a+(i-a)*Math.pow(o,2)}}add(e,t,n){this.data[e]={value:t,interpolation:n}}remove(e){delete data[e]}};t.name=e,this.tracks.push(t)}};n.d(t,"SyncDevice",function(){return class{constructor(e){this.connected=!1,this.previousIntRow,this.device,this.config={socketURL:"ws://localhost:1339",rocketXML:""},this.eventHandler={ready:()=>{},update:()=>{},play:()=>{},pause:()=>{}},this.setConfig(e),this.deviceReady=this.deviceReady.bind(this),this.deviceUpdate=this.deviceUpdate.bind(this),this.devicePlay=this.devicePlay.bind(this),this.devicePause=this.devicePause.bind(this)}init(e){this.device="demo"===e?new class{constructor(e){if(this.urlRequest,this.syncData=new s,this.eventHandler={ready:()=>{},error:()=>{}},""===e.rocketXML||void 0===e.rocketXML||void 0===e.rocketXML)throw"rocketXML is not set, try SyncDevice.setConfig({'rocketXML':'url/To/RocketXML.rocket'})";this.load(e.rocketXML)}load(e){this.urlRequest=new XMLHttpRequest,null!==this.urlRequest?(this.urlRequest.open("GET",e,!0),this.urlRequest.onreadystatechange=(()=>{4===this.urlRequest.readyState&&(this.urlRequest.status<300?this.readXML(this.urlRequest.responseText):this.eventHandler.error())}),this.urlRequest.send()):this.eventHandler.error()}readXML(e){let t,n,s,r=0,a=0;const i=(new DOMParser).parseFromString(e,"text/xml").getElementsByTagName("tracks")[0].getElementsByTagName("track");for(n=i.length;r<n;r++){const e=this.getTrack(i[r].getAttribute("name")),n=i[r].getElementsByTagName("key");for(a=0,s=n.length;a<s;a++)t=n[a],e.add(parseInt(t.getAttribute("row"),10),parseFloat(t.getAttribute("value")),parseInt(t.getAttribute("interpolation"),10))}this.eventHandler.ready()}getTrack(e){const t=this.syncData.getIndexForName(e);return t>-1?this.syncData.getTrack(t):(this.syncData.createIndex(e),this.syncData.getTrack(this.syncData.getTrackLength()-1))}on(e,t){this.eventHandler[e]=t}setRow(){}}(this.config):new class{constructor(e){this.ws=new WebSocket(e.socketURL),this.syncData=new s,this.eventHandler={ready:()=>{},update:()=>{},play:()=>{},pause:()=>{},save:()=>{}},this.onOpen=this.onOpen.bind(this),this.onMessage=this.onMessage.bind(this),this.onClose=this.onClose.bind(this),this.onError=this.onError.bind(this),this.ws.addEventListener("open",this.onOpen),this.ws.addEventListener("message",this.onMessage),this.ws.addEventListener("close",this.onClose),this.ws.addEventListener("error",this.onError)}onOpen(){this.ws.binaryType="arraybuffer",this.ws.send("hello, synctracker!")}onMessage(e){const t=new Uint8Array(e.data),n=t[0];let s,r,a,i;104===n?this.eventHandler.ready():4===n?1===t[1]?this.eventHandler.pause():this.eventHandler.play():3===n?(r=this.toInt(t.subarray(1,5)),this.eventHandler.update(r)):0===n?(s=this.toInt(t.subarray(1,5)),r=this.toInt(t.subarray(5,9)),a=this.toFloat(t.subarray(9,13)),i=this.toInt(t.subarray(13,14)),this.syncData.getTrack(s).add(r,a,i)):1===n?(s=this.toInt(t.subarray(1,5)),r=this.toInt(t.subarray(5,9)),this.syncData.getTrack(s).remove(r)):5===n&&this.eventHandler.save()}onClose(e){console.warn("connection closed",e)}onError(e){console.warn("connection error'd",e)}getTrack(e){const t=this.syncData.getIndexForName(e);if(t>-1)return this.syncData.getTrack(t);const n=encodeURIComponent(e).replace(/%([\dA-F]{2})/g,(e,t)=>String.fromCharCode("0x"+t)),s=[2,n.length>>24&255,n.length>>16&255,n.length>>8&255,255&n.length];for(var r=0;r<n.length;r++)s.push(n.charCodeAt(r));return this.ws.send(new Uint8Array(s).buffer),this.syncData.createIndex(e),this.syncData.getTrack(this.syncData.getTrackLength()-1)}setRow(e){const t=[e>>24&255,e>>16&255,e>>8&255,255&e];this.ws.send(new Uint8Array([3,t[0],t[1],t[2],t[3]]).buffer)}toInt(e){let t=0;const n=new DataView(new ArrayBuffer(e.length));for(;t<e.length;t++)n.setUint8(t,e[t]);return 1===n.byteLength?n.getInt8(0):n.getInt32(0)}toFloat(e){const t=new DataView(new ArrayBuffer(4));return t.setUint8(0,e[0]),t.setUint8(1,e[1]),t.setUint8(2,e[2]),t.setUint8(3,e[3]),t.getFloat32(0)}on(e,t){this.eventHandler[e]=t}}(this.config),this.device.on("ready",this.deviceReady),this.device.on("update",this.deviceUpdate),this.device.on("play",this.devicePlay),this.device.on("pause",this.devicePause)}getConfig(){return this.config}setConfig(e){this.config=Object.assign({},this.config,e)}deviceReady(){this.connected=!0,this.eventHandler.ready()}devicePlay(){this.eventHandler.play()}deviceUpdate(e){this.eventHandler.update(e)}devicePause(){this.eventHandler.pause()}getTrack(e){return this.connected?this.device.getTrack(e):(console.warn("client not connected"),null)}update(e){Math.floor(e)!==this.previousIntRow&&(this.previousIntRow=Math.floor(e),this.device.setRow(this.previousIntRow))}on(e,t){this.eventHandler[e]=t}}})}])});